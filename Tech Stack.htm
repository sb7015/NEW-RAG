<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technology Stack - Multi-Division Knowledge Management System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #281849 0%, #5009B5 100%);
            padding: 30px;
            min-height: 100vh;
            color: #231E33;
        }
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: #F5F5F5;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(40, 24, 73, 0.4);
            padding: 40px;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 4px solid #00BEBA;
        }
        .header h1 {
            color: #281849;
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 700;
        }
        .header .subtitle {
            color: #5009B5;
            font-size: 18px;
            font-weight: 600;
        }
        .feature-banner {
            background: linear-gradient(135deg, #00BEBA 0%, #00B5F5 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
            font-weight: 600;
        }
        .category-section { margin-bottom: 40px; }
        .category-title {
            background: linear-gradient(135deg, #00BEBA 0%, #00B5F5 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 8px rgba(80, 9, 181, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        thead { background: #281849; color: white; }
        thead th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
        }
        tbody tr { border-bottom: 1px solid #EBE4FF; }
        tbody tr:hover { background: #F5F5F5; }
        td { padding: 15px; vertical-align: top; font-size: 13px; line-height: 1.6; }
        .tech-name { font-weight: 700; color: #281849; font-size: 14px; }
        .aws-badge {
            background: #794CFF;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 8px;
            display: inline-block;
        }
        .highlight { background: #D9F5F5; padding: 2px 6px; border-radius: 3px; font-weight: 600; color: #00BEBA; }
        .cost-info { background: #EBE4FF; padding: 2px 6px; border-radius: 3px; font-size: 11px; color: #281849; font-weight: 600; }
        .citation-demo {
            background: #231E33;
            color: #00BEBA;
            padding: 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
            overflow-x: auto;
        }
        .summary-box {
            background: linear-gradient(135deg, #281849 0%, #5009B5 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            margin-top: 30px;
        }
        .summary-title { font-size: 20px; font-weight: 700; margin-bottom: 15px; color: #00BEBA; }
        .summary-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .summary-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid rgba(0,190,186,0.3);
        }
        .summary-item strong { display: block; margin-bottom: 5px; font-size: 16px; color: #00BEBA; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ†Ô∏è Technology Stack Details</h1>
            <div class="subtitle">With Clickable Page-Level Citation Navigation</div>
        </div>

        <div class="feature-banner">
            üîó New Feature: Click any citation [Page X] to open the exact source document directly on that page using S3 pre-signed URLs with PDF anchors
        </div>

        <!-- Citation Feature Section -->
        <div class="category-section">
            <div class="category-title">üîó Citation Navigation System</div>
            <table>
                <thead>
                    <tr>
                        <th style="width: 20%;">Component</th>
                        <th style="width: 40%;">Implementation Details</th>
                        <th style="width: 40%;">Technical Approach</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="tech-name">Page Detection</div>
                            <span class="aws-badge">Textract</span>
                        </td>
                        <td>
                            <ul style="margin-left: 15px;">
                                <li>Detects page boundaries during OCR</li>
                                <li>Captures bounding box geometry (optional highlighting)</li>
                                <li>Maps text blocks to specific page numbers</li>
                            </ul>
                        </td>
                        <td>
                            Amazon Textract <code>DetectDocumentText</code> returns Page attribute for every Block. Stored in Pinecone metadata as <code>page_num: integer</code>.
                            <br><span class="cost-info">Included in Textract pricing</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="tech-name">Link Generation</div>
                            <span class="aws-badge">Lambda</span>
                        </td>
                        <td>
                            <ul style="margin-left: 15px;">
                                <li>Generates S3 pre-signed URLs on-demand</li>
                                <li>Appends PDF page anchor (#page=X)</li>
                                <li>Validates user access before generating</li>
                            </ul>
                            <div class="citation-demo">
user_clicks_citation(citation_id) 
  ‚Üí Lambda validates IAM access 
  ‚Üí generates url: s3://bucket/doc.pdf?sig=xxx#page=12
  ‚Üí returns 302 redirect to browser
                            </div>
                        </td>
                        <td>
                            <span class="highlight">Security:</span> URLs expire in 1 hour (configurable). Each click validates Cognito permissions against document division. Integrates with CloudTrail for audit.
                            <br><br>
                            <span class="cost-info">S3: $0.0004 per 1,000 GET requests</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="tech-name">Frontend Rendering</div>
                            <span class="aws-badge">React</span>
                        </td>
                        <td>
                            <ul style="margin-left: 15px;">
                                <li>Renders citations as hyperlinks [Page X]</li>
                                <li>Opens in new tab (_blank)</li>
                                <li>Handles expired links (refreshes pre-signed URL)</li>
                            </ul>
                        </td>
                        <td>
                            React component parses citation metadata, generates anchor tag:<br>
                            <code>&lt;a href="[pre-signed-url#page=12]" target="_blank"&gt;Page 12&lt;/a&gt;</code><br>
                            PDF opens in browser's native viewer directly on page 12.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- AI/ML Services -->
        <div class="category-section">
            <div class="category-title">ü§ñ AI/ML Services & LLM Layer</div>
            <table>
                <thead>
                    <tr><th>Technology</th><th>Primary Use Cases</th><th>Why This Technology?</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="tech-name">Amazon Bedrock</div>
                            <span class="aws-badge">AWS</span>
                        </td>
                        <td>
                            <ul style="margin-left: 15px;">
                                <li>Claude 3.5 Sonnet (Research Agent reasoning)</li>
                                <li>Claude Haiku (Router Agent)</li>
                                <li>Cohere Embed v3 (vectors)</li>
                            </ul>
                        </td>
                        <td>
                            Managed service with <span class="highlight">pay-per-use</span> pricing. Supports citation generation with structured JSON output including S3 references.
                            <br><span class="cost-info">Cost: ~$0.003-0.015 per 1K tokens</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="tech-name">Bedrock Agents</div>
                            <span class="aws-badge">AWS</span>
                        </td>
                        <td>
                            <ul style="margin-left: 15px;">
                                <li>2-Agent orchestration</li>
                                <li>Action group for "generate_citation_link"</li>
                                <li>Session management</li>
                            </ul>
                        </td>
                        <td>
                            Action group allows Research Agent to call Lambda for <span class="highlight">fresh S3 pre-signed URLs</span> on every citation click (security).
                            <br><span class="cost-info">Cost: $0.0025 per invocation</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Document Processing -->
        <div class="category-section">
            <div class="category-title">üìÑ Document Processing & Citation Layer</div>
            <table>
                <thead>
                    <tr><th>Technology</th><th>Primary Use Cases</th><th>Why This Technology?</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="tech-name">Amazon Textract</div>
                            <span class="aws-badge">AWS</span>
                        </td>
                        <td>
                            <ul style="margin-left: 15px;">
                                <li>OCR with <strong>page number detection</strong></li>
                                <li>Bounding box coordinates for highlighting</li>
                                <li>Multi-page PDF processing</li>
                            </ul>
                        </td>
                        <td>
                            <span class="highlight">Critical for citations:</span> Returns "Page" attribute for every text block. Enables exact page linking in S3 URLs (<code>#page=12</code>).
                            <br><span class="cost-info">Cost: $1.50 per 1,000 pages</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="tech-name">Amazon S3</div>
                            <span class="aws-badge">AWS</span>
                        </td>
                        <td>
                            <ul style="margin-left: 15px;">
                                <li>Document storage with metadata</li>
                                <li><strong>Pre-signed URLs</strong> with expiration</li>
                                <li>Page anchor support (#page=X)</li>
                            </ul>
                        </td>
                        <td>
                            S3 supports <span class="highlight">PDF fragment identifiers</span> (#page) which browsers respect when opening PDFs. Pre-signed URLs allow temporary secure access without exposing bucket permissions.
                            <br><span class="cost-info">Cost: $0.0004 per 1,000 GET requests</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="tech-name">Pinecone Serverless</div>
                            <span class="aws-badge">Vector DB</span>
                        </td>
                        <td>
                            <ul style="margin-left: 15px;">
                                <li>Vector storage</li>
                                <li>Metadata: <code>{s3_path, page_num, division}</code></li>
                                <li>Filter by division</li>
                            </ul>
                        </td>
                        <td>
                            Stores <span class="highlight">page_number</span> metadata alongside vectors. When Agent retrieves chunk, it gets the S3 path and page number to construct citation link.
                            <br><span class="cost-info">Cost: ~$0.10 per 1K queries</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Integration -->
        <div class="category-section">
            <div class="category-title">üîó Integration & Citation Delivery</div>
            <table>
                <thead>
                    <tr><th>Technology</th><th>Primary Use Cases</th><th>Why This Technology?</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="tech-name">AWS Lambda</div>
                            <span class="aws-badge">Citation Service</span>
                        </td>
                        <td>
                            <ul style="margin-left: 15px;">
                                <li><strong>generate_citation_link()</strong> function</li>
                                <li>Validate user access (Cognito)</li>
                                <li>Create pre-signed S3 URL + page anchor</li>
                            </ul>
                            <div class="citation-demo">
def generate_link(s3_key, page, user):
    if not has_access(user, s3_key): 
        raise 403
    url = s3.generate_presigned_url(
        'get_object',
        Params={'Bucket': 'docs', 'Key': s3_key},
        ExpiresIn=3600
    )
    return f"{url}#page={page}"
                            </div>
                        </td>
                        <td>
                            Ensures <span class="highlight">security:</span> Checks IAM permissions before generating URL. Prevents deep-linking to unauthorized documents. Logs access for audit.
                            <br><br>
                            <span class="cost-info">Lambda: $0.20 per 1M invocations</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="tech-name">Amazon CloudTrail</div>
                            <span class="aws-badge">AWS</span>
                        </td>
                        <td>
                            <ul style="margin-left: 15px;">
                                <li>Log every citation link generation</li>
                                <li>Audit trail of document access</li>
                                <li>Compliance reporting (who viewed what page)</li>
                            </ul>
                        </td>
                        <td>
                            Required for insurance compliance. Tracks <span class="highlight">which user accessed which page</span> of which document at what time. Immutable logs for SOX/HIPAA.
                            <br><span class="cost-info">Cost: First trail free</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Summary Box -->
        <div class="summary-box">
            <div class="summary-title">üìà Architecture Summary with Citations</div>
            <div class="summary-content">
                <div class="summary-item">
                    <strong>Click to Page</strong>
                    Textract page data + S3 #page anchor = Exact document navigation
                </div>
                <div class="summary-item">
                    <strong>Security</strong>
                    Pre-signed URLs expire in 1hr + IAM validation on every click
                </div>
                <div class="summary-item">
                    <strong>Audit Trail</strong>
                    CloudTrail logs every citation click with user, timestamp, page
                </div>
                <div class="summary-item">
                    <strong>Cost</strong>
                    ~$0.0004 per citation click (S3 GET request)
                </div>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 30px; color: #5009B5; padding: 20px; background: #EBE4FF; border-radius: 8px;">
            <strong>Citation Link Format:</strong> <code style="background: #231E33; color: #00BEBA; padding: 5px 10px; border-radius: 4px;">https://s3.../policy.pdf?X-Amz-Signature=xxx#page=12</code>
        </div>
    </div>
</body>
</html>